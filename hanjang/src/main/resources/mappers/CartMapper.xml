<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycompany.myapp.service.dao.CartDAO">

	<resultMap id="cartMap" type="com.mycompany.myapp.vo.CartVO">
		<result property="userNo" column="UserNo" />
		<result property="itemId" column="ItemId" />
		<result property="cartNo" column="CartNo" />
		<result property="amount" column="Amount" />
	</resultMap>

	<resultMap id="bookMap" type="com.mycompany.myapp.vo.BookVO">
		<result property="itemID" column="ItemId" />
		<result property="title" column="Title" />
		<result property="isbn" column="Isbn" />
		<result property="author" column="Author" />
		<result property="description" column="Description" />
		<result property="priceStandard" column="PriceStandard" />
		<result property="coverLargeUrl" column="CoverLargeUrl" />
		<result property="categoryId" column="CategoryId" />
		<result property="categoryName" column="CategoryName" />
		<result property="publisher" column="Publisher" />
		<result property="pubDate" column="PubDate" />
	</resultMap>

	<resultMap type="com.mycompany.myapp.vo.CartProductVO"
		id="cartProductMap">
		<collection property="cartVO" resultMap="cartMap" />
		<collection property="bookVO" resultMap="bookMap" />
	</resultMap>

	<resultMap type="com.mycompany.myapp.vo.OrderListVO" id="orderListMap">
		<result property="orderListNo" column="OrderListNo" />
		<result property="userNo" column="UserNo" />
		<result property="cartNo" column="CartNo" />
		<result property="itemId" column="ItemId" />
	</resultMap>

	<!-- 카트 insert -->
	<insert id="insertCart" parameterType="cartVO">
		INSERT INTO Cart(UserNo,
		ItemId, Amount)
		VALUES(#{userNo}, #{itemId}, #{amount})
	</insert>

	<!-- 카트 특정유저 장바구니 확인 -->
	<select id="getOneCart" resultMap="cartProductMap">
		SELECT * FROM Cart c, Book b
		WHERE UserNo = #{userNo} AND c.ItemId = b.ItemId
	</select>

	<!-- 장바구니 수정 -->
	<update id="updateCart" parameterType="cartVO">
		UPDATE Cart
		SET Amount = #{amount}
		<if test="cartNo != null">
			WHERE CartNo = #{cartNo}
		</if>
	</update>

	<!-- 장바구니 삭제 -->
	<delete id="deleteCart" parameterType="cartVO">
		DELETE FROM Cart 
		WHERE CartNo = #{cartNo}
	</delete>

	<!-- 장바구니에서 주문리스트DB에 추가 -->
	<insert id="insertOrderList" parameterType="orderListVO">
		INSERT INTO OrderList(OrderListNo, CartNo)
		VALUES(#{orderListNo}, #{cartNo})
	</insert>

	<!-- 주문확인서  -->
	<select id="getOneOrderList" parameterType="int" resultMap="orderListMap">
		SELECT * FROM OrderList
		WHERE UserNo = #{userNo}
	</select> 
</mapper>

